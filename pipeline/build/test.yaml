trigger:
  branches:
    include:
        - master

pool:
  vmImage: 'ubuntu-latest'

stages:
- stage: Tester
  displayName: 'First try'
  jobs:
    - job: Tester
      steps:
        - task: UsePythonVersion@0
          inputs:
             versionSpec: '3.x'
        - script:  |
            python -m pip install --upgrade pip
            pip install -r requirements.txt
          displayName: Install Dependencies
        
        - script: |
            pytest --junitxml=test-results.xml --html=report.html --self-contained-html
          displayName: 'Run tests'
        
        - task: PublishTestResults@2
          inputs:
            testResultsFormat: 'JUnit'
            testResultsFiles: '**/test-*.xml'
            failTaskOnFailedTests: true
        
        - task: PublishBuildArtifacts@1
          inputs:
            pathToPublish: 'report.html'
            artifactName: 'TestReport'